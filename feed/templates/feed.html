{% extends 'base.html' %}
{% block content %}

    <h1 class="pacifico-regular-allPage">Feed</h1>
    <!-- <li><a href="{% url 'profilepage' request.user.username %}">Profile</a></li> -->

    <!-- <li><a href="{% url 'favorites' %}">Favorite Posts</a></li><br> -->

    <!-- Favorite Posts Icon Link -->
    <div class="text-center mt-4">
        <a href="{% url 'favorites' %}" class="icon-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
                <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
              </svg>
            <span>Favorite Posts</span>
        </a>
    </div>



    <!-- Upload box -->
    <!-- <div class="upload">

        <div>
            <form action="{% url 'upload' %}" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="image" accept="image/*" value="Media"><br>  
                <input type="file" name="video" accept="video/*" value="Video"><br> 
                <textarea name="caption" cols="20" rows="5" placeholder="Your Caption"></textarea><br>
                <input type="submit" value="Upload">
            </form>
        </div>
    </div>
    <br> -->

    <!-- Upload Icon -->
    <a href="{% url 'upload_page' %}" class="upload-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
            <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
        </svg>
        <p>Upload</p>
    </a>


    




    <!-- <div uk-dropdown="pos: top-right; mode: click; animation: uk-animation-slide-bottom-small" class="header_dropdown" style="width: 200px;" height="100px">
        <div class="px-4 py-3 -mx-5 -mt-4 mb-3 border-b">
            <h4 class="text-center">Upload Media</h4>
        </div>
    
        <div class="flex justify-center flex-center text-center">
            <div class="flex flex-col choose-upload text-center">
                <div class="bg-gray-100 border-2 border-dashed flex flex-col h-16 items-center justify-center relative w-full rounded-lg mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-10" height="100px">
                        <path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.413l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13H5.5z" />
                        <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                    </svg>
                </div>
                <div class="mb-3">
                    <label for="caption" class="form-label">Caption</label>
                    <textarea name="caption" id="caption" cols="10" rows="3" placeholder="Your Caption" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-sm w-full">Upload</button>
            </div>
        </div>
        <div class="px-4 py-3 -mx-5 -mb-4 mt-3 border-t text-sm">
            Your image size must be maximum 999MB
        </div>
    </div> -->

    
    
    
    





    <!-- Feed posts -->
<div class="container">
    {% for post in posts reversed %}

    <div class="card mb-3">

                                        <!-- Card Header -->

        <div class="card-header">

            <!-- Username -->
            <h5 class="card-title"><a href="{% url 'profilepage' post.user.username %}">{{ post.user }}</a></h5>

            <!-- Profile image -->
            <a href="{% url 'profilepage' post.user.username %}">
                <img src="{{ post.user.profile.profileimg.url }}" alt="Profile Image" class="img-fluid rounded-circle" width="30" height="30">
            </a>
        </div>


                                        <!-- Card Body -->
        <div class="card-body">

            <!-- Post image -->
            <a href="{{ post.image.url }}">
                <img src="{{ post.image.url }}" alt="Post Image" class="img-fluid" width="200" height="200">
            </a>

            <!-- Created at -->
            <p class="card-text">{{ post.created_at }}</p>
            <!-- Caption -->

            <p class="card-text">{{ post.caption }}</p>
        </div>


                                        <!-- Card Footer -->
        <div class="card-footer">

            <!-- Like Button -->
            <form action="{% url 'like_post' post.id %}" method="POST" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">
                    {% if request.user in post.likes.all %}
                        Unlike
                    {% else %}
                        Like
                    {% endif %}
                </button>
            </form>

            <!-- Download Button -->
            <a href="{{ post.image.url }}" download class="btn btn-secondary ms-2">Download</a>

            <!-- Post Favorite -->
            {% if request.user.is_authenticated %}
                {% if post not in request.user.profile.favorites.all %}
                    <form action="{% url 'add_to_favorites' post.id %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning ms-2">Add to Favorites</button>
                    </form>
                {% else %}
                    <form action="{% url 'remove_from_favorites' post.id %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger ms-2">Remove from Favorites</button>
                    </form>
                {% endif %}
            {% endif %}


            <!-- Likes count -->
            <span class="ms-auto">{{ post.likes.count }} 
                {% if post.likes.count == 1 %}
                    Like
                {% else %}
                    Likes
                {% endif %}
            </span>
        </div>
    </div>
    {% endfor %}
</div>
    

{% endblock %}