{% extends 'base.html' %}
{% block content %}

    <h1 class="pacifico-regular-allPage">Feed Page</h1>
    <!-- <li><a href="{% url 'profilepage' request.user.username %}">Profile</a></li> -->
    <li><a href="{% url 'favorites' %}">Favorite Posts</a></li><br>

    <!-- Upload box -->
    <div class="upload">

        <div>
            <form action="{% url 'upload' %}" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="image" accept="image/*" value="Image "><br>  <!-- For image -->
                <input type="file" name="video" accept="video/*" value="Video"><br>  <!-- For video -->
                <textarea name="caption" cols="20" rows="5" placeholder="Your Caption"></textarea><br>
                <input type="submit" value="Upload">
            </form>
        </div>
    </div>
    <br>

    <!-- Feed posts -->
<div class="container">
    {% for post in posts reversed %}

    <div class="card mb-3">

                                        <!-- Card Header -->

        <div class="card-header">

            <!-- Username -->
            <h5 class="card-title"><a href="{% url 'profilepage' post.user.username %}">{{ post.user }}</a></h5>

            <!-- Profile image -->
            <a href="{% url 'profilepage' post.user.username %}">
                <img src="{{ post.user.profile.profileimg.url }}" alt="Profile Image" class="img-fluid rounded-circle" width="30" height="30">
            </a>
        </div>


                                        <!-- Card Body -->
        <div class="card-body">

            <!-- Post image -->
            <a href="{{ post.image.url }}">
                <img src="{{ post.image.url }}" alt="Post Image" class="img-fluid" width="200" height="200">
            </a>

            <!-- Created at -->
            <p class="card-text">{{ post.created_at }}</p>
            <!-- Caption -->

            <p class="card-text">{{ post.caption }}</p>
        </div>


                                        <!-- Card Footer -->
        <div class="card-footer">

            <!-- Like Button -->
            <form action="{% url 'like_post' post.id %}" method="POST" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">
                    {% if request.user in post.likes.all %}
                        Unlike
                    {% else %}
                        Like
                    {% endif %}
                </button>
            </form>

            <!-- Download Button -->
            <a href="{{ post.image.url }}" download class="btn btn-secondary ms-2">Download</a>

            <!-- Post Favorite -->
            {% if request.user.is_authenticated %}
                {% if post not in request.user.profile.favorites.all %}
                    <form action="{% url 'add_to_favorites' post.id %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning ms-2">Add to Favorites</button>
                    </form>
                {% else %}
                    <form action="{% url 'remove_from_favorites' post.id %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger ms-2">Remove from Favorites</button>
                    </form>
                {% endif %}
            {% endif %}
            <!-- Likes count -->
            <span class="ms-auto">{{ post.likes.count }} 
                {% if post.likes.count == 1 %}
                    Like
                {% else %}
                    Likes
                {% endif %}
            </span>
        </div>
    </div>
    {% endfor %}
</div>
    

{% endblock %}